local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local ANIMATION_WHITELIST = {
	-- Astronaut
	891636393, 891627522, 891621366, 891633237, 1047759695, 891617961, 891639666, 891663592, 891609353,
	-- Bubbly
	910025107, 910034870, 910016857, 910004836, 910009958, 1018536639, 910001910, 910028158, 910030921, 909997997,
	-- Cartoony
	742638842, 742640026, 742637942, 742637544, 742638445, 885477856, 742637151, 742639220, 742639812, 742636889,
	-- Elder
	845386501, 845403856, 845398858, 845397899, 845400520, 901160519, 845396048, 845401742, 845403127, 845392038,
	-- Knight
	657564596, 657552124, 658409194, 657595757, 657568135, 885499184, 657600338, 657560551, 657557095, 658360781,
	-- Levitation
	616010382, 616013216, 616008936, 616006778, 616008087, 886862142, 616005863, 616011509, 616012453, 616003713,
	-- Mage
	707861613, 707897309, 707853694, 707742142, 707855907, 885508740, 707829716, 707876443, 707894699, 707826056,
	-- Ninja
	656118852, 656121766, 656117878, 656117400, 656118341, 886742569, 656115606, 656119721, 656121397, 656114359,
	-- Pirate
	750783738, 750785693, 750782230, 750781874, 750782770, 885515365, 750780242, 750784579, 750785176, 750779899,
	-- Robot
	616091570, 616095330, 616090535, 616088211, 616089559, 885531463, 616087089, 616092998, 616094091, 616086039,
	-- Rthro
	2510198475, 2510202577, 2510197830, 2510197257, 2510196951, 3711062489, 2510195892, 2510199791, 2510201162, 2510192778,
	-- Stylish
	616140816, 616146177, 616139451, 616136790, 616138447, 886888594, 616134815, 616143378, 616144772, 616133594,
	-- Superhero
	616117076, 616122287, 616115533, 616111295, 616113536, 885535855, 616108001, 616119360, 616120861, 616104706,
	-- Toy
	782842708, 782843345, 782847020, 782841498, 782845736, 980952228, 782846423, 782844582, 782845186, 782843869,
	-- Vampire
	1083462077, 1083473930, 1083455352, 1083445855, 1083450166, 1088037547, 1083443587, 1083464683, 1083467779, 1083439238,
	-- Werewolf
	1083216690, 1083178339, 1083218792, 1083195517, 1083214717, 1099492820, 1083189019, 1083222527, 1083225406, 1083182000,
	-- Zombie
	616163682, 616168032, 616161997, 616158929, 616160636, 885545458, 616157476, 616165109, 616166655, 616156119,
	-- R6 animations
	180435571, 180435792, 180426354, 125750702, 180436148, 180436334, 178130996, 182393478, 129967390, 129967478, 128777973, 128853357, 182435998, 182491037, 182491065, 182436842, 182491248, 182491277, 182436935, 182491368, 182491423, 129423131, 129423030,
	-- R15 animations
	507770677, 507765644, 507771019, 507771955, 507772104, 507776043, 507776720, 507776879, 507777268, 507777451, 507777623, 507767968, 507766388, 507766666, 507765000, 507770818, 507770453, 2506281703, 522638767, 507768375, 522635514, 507770239, 913376220, 913384386, 913389285, 913402848, 14618196485,
	-- Wicked Popular
	131326830509784, 121152442762481, 104325245285198, 118832222982049, 72301599441680, 99384245425157, 92072849924640,
	-- Catwalk Glam by e.l.f.
	119377220967554, 92294537340807, 116936326516985, 81024476153754, 133806214992291, 134591743181628, 109168724482748,
	-- adidas Community
	88763136693023, 98600215928904, 122150855457006, 133308483266208, 122257458498464, 82598234841035, 75290611992385,
	-- Bold by e.l.f.
	16738332169, 16738333171, 16738333868, 16738336650, 16738337225, 16738339158, 16738340646,
	-- Wicked "Dancing Through Life"
	129447497744818, 78147885297412, 135515454877967, 78508480717326, 92849173543269, 110657013921774, 73718308412641,
	-- Unboxed by Amazon
	121145883950231, 94788218468396, 121454505477205, 134824450619865, 98281136301627, 105962919001086, 90478085024465,
	-- adidas Sports
	18537384940, 18537392113, 18537376492, 18537380791, 18537389531, 18537367238, 18537363391,
	-- adidas aura
	97824616490448, 95603166884636, 109996626521204, 118320322718866, 110211186840347, 134530128383903, 83842218823011,
	-- No Boundaries by Walmart
	18747060903, 18747062535, 18747067405, 18747069148, 18747070484, 18747073181, 18747074203,
	-- Oldschool
	10921240218, 10921244891, 10921241244, 10921242013, 10921230744, 10921243048, 10921229866,
	-- NFL
	134630013742019, 129773241321032, 92080889861410, 119846112151352, 117333533048078, 132697394189921, 110358958299415,
	-- Misc
	10921259953, 10789327257, 10921261968, 10921269718, 14366558676, 10921258489, 76049494037641, 102357151005774, 507766951
}

local whitelistSet = {}
for _, id in ipairs(ANIMATION_WHITELIST) do
	whitelistSet[id] = true
end

local function isWhitelisted(animationId)
	if #ANIMATION_WHITELIST == 0 then
		return false
	end
	return whitelistSet[animationId] == true
end

local function monitorCharacter(character)
	local humanoid = character:WaitForChild("Humanoid", 10)
	if not humanoid then
		return
	end
	
	local function cancelNonWhitelistedTracks()
		for _, track in pairs(humanoid:GetPlayingAnimationTracks()) do
			local anim = track.Animation
			if anim then
				local animationId = anim.AnimationId
				if animationId then
					local idString = tostring(animationId)
					local numericId = tonumber(idString:match("%d+"))
					
					if numericId and not isWhitelisted(numericId) then
						track:Stop()
					end
				end
			end
		end
	end
	
	local connection
	connection = RunService.Heartbeat:Connect(function()
		if not character.Parent or not humanoid.Parent then
			connection:Disconnect()
			return
		end
		cancelNonWhitelistedTracks()
	end)
	
	character.AncestryChanged:Connect(function()
		if not character.Parent then
			connection:Disconnect()
		end
	end)
end

Players.PlayerAdded:Connect(function(player)
	player.CharacterAdded:Connect(function(character)
		monitorCharacter(character)
	end)
	
	if player.Character then
		monitorCharacter(player.Character)
	end
end)

for _, player in pairs(Players:GetPlayers()) do
	if player.Character then
		monitorCharacter(player.Character)
	end
	player.CharacterAdded:Connect(function(character)
		monitorCharacter(character)
	end)
end
